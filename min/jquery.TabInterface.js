/* (c) Aaron Gustafson (@AaronGustafson). MIT License. http://github.com/easy-designs/jquery.TabInterface.js v1.5 */
(function(e,g,v){var m=(new Date()).getTime(),f=true,l=false,o=null,q="destroy",k="TabInterface",u=k+"-enabled",b="aria-activedescendant",t="aria-controls",n="hidden",r="next",p="prev",d="click",c="[role=tab]",i=e(g),a=g.location,j=0,h={threshold:0,active_class:u,tabpanel_el:"section",tabpanel_class:k+"-tabpanel",tabpanel_hidden_class:k+"-tabpanel-"+n,tablist_el:"ol",tablist_class:k+"-tablist",tablist_position:"before",tab_el:"li",tab_class:k+"-tab",tab_active_class:k+"-active",tab_thumbnail_class:k+"tab-thumbnail",hide_headers:f,heading_hidden_class:k+"-heading-"+n,oninit:function(){},oncomplete:function(){},onbeforechange:function(){},onafterchange:function(){}};if("ontouchstart" in g||"createTouch" in document){d="touchend"}g.watchResize=function(y){var x;function w(){clearTimeout(x);x=o;y()}i.resize(function(){if(x){clearTimeout(x);x=o}x=setTimeout(w,50)});y()};g.watchResize(function(){j=i.width()});function s(B,C){var D,w=C.tablist.clone(),y=o;function A(){B.oninit.call(this);D=e(this);var T=D.children().eq(0),O=D.attr("id")||k+"-"+m++,V=l,G,E,Q,R,J,K,M,L,I=B.hide_headers,P,W,X,H,F;if(D.data(u)){return}if(D.is("[data-tab-hide-headers]")){I=!(D.data("tab-hide-headers")=="false")}if(T.is("h1, h2, h3, h4, h5, h6")){V=T.get(0).nodeName.toLowerCase();D.data(u,f).addClass(B.active_class).attr({id:O,role:"application"});G=new RegExp("<("+V+")","ig");E=D.html().replace(G,"||||<$1").split("||||");E.shift();D.html("");for(Q=0,R=E.length;Q<R;Q++){K=O+"-"+Q+"-tabpanel";L=O+"-"+Q+"-tab";J=C.tabpanel.clone().attr({id:K,"aria-labelledby":L}).html(E[Q]).appendTo(D);M=C.tab.clone().attr({id:L,"aria-controls":K,"aria-describedby":K}).appendTo(w);P=J.find(V).eq(0);W=P.data("tab-title");X=P.data("tab-thumbnail");if(X){W+=' <img class="'+B.tab_thumbnail_class+'" src="'+X+'" alt=""/>'}M.html(W||P.html());if(I&&!W){P.attr(n,n).addClass(B.heading_hidden_class)}if(Q===0){D.attr(b,K);J.attr("aria-hidden","false").removeClass(B.tabpanel_hidden_class).removeAttr(n);M.attr({"aria-selected":"true",tabindex:"0"}).addClass(B.tab_active_class)}}w.on(d+" focus",c,N).on("keydown",c,U);D[(B.tablist_position=="before"?"prepend":"append")](w);H=D.find(V);F=H.filter("[data-tab-focus]");if(F.length>0){w.find(c).eq(H.index(F)).trigger(d)}i.on("hashchange load",S);B.oncomplete.call(this)}function S(){var Z=a.hash,Y=H.filter(Z);if(Y.length>0){w.find(c).eq(H.index(Y)).trigger(d);i.scrollTop(w.offset().top)}}function N(ad){var Z=B.tab_active_class,ae=B.tabpanel_hidden_class,ab=e(ad.target).closest("[role=tab]"),ac=ab.get(0),Y=D.attr(b),aa=ab.attr(t);if(y&&y==ac){return}y=ac;B.onbeforechange.call(this);w.find("[aria-selected=true]").removeClass(Z).attr({"aria-selected":"false",tabindex:"-1"});e("#"+Y,D).addClass(ae).attr({"aria-hidden":"true",hidden:"hidden"});ab.addClass(Z).attr({"aria-selected":"true",tabindex:"0"});e("#"+aa,D).removeClass(ae).attr("aria-hidden","false").removeAttr("hidden");D.attr(b,aa);B.onafterchange.call(this)}function U(Y){switch(Y.which){case 13:e("#"+e(Y.target).attr(t)).focus();break;case 37:case 38:x(p,false);break;case 39:case 40:x(r,false);break;case 36:x(p,true);break;case 35:x(r,true);break;case 27:e(Y.target).blur();break}}}function x(J,F){var F=F||l,I=w.find("[aria-selected=true]"),H=w.find("[role=tab]:first-child"),G=w.find("[role=tab]:last-child"),E;if(F){(J==p?H:G).focus()}else{E=I[J==p?p:r]();if(E.length){E.focus()}else{(J==r?H:G).focus()}}}function z(){D=e(this).removeClass(u).removeAttr(b).removeAttr("role");D.find("[role=tablist]").remove();D.find("[role=tabpanel] > *").unwrap();D.find("."+B.heading_hidden_class).removeAttr(n).removeClass(B.heading_hidden_class)}this.create=A;this.move=x;this.destroy=z}e.fn.TabInterface=function(w){var z=e(this),x=e.extend(h,w),y={tabpanel:e("<"+x.tabpanel_el+' class="'+x.tabpanel_class+" "+x.tabpanel_hidden_class+'"/>').attr({"aria-hidden":"true",hidden:"hidden",role:"tabpanel",tabindex:"-1"}),tab:e("<"+x.tab_el+' class="'+x.tab_class+'"/>').attr({role:"tab","aria-selected":"false",tabindex:"-1"}),tablist:e("<"+x.tablist_el+' class="'+x.tablist_class+'"/>').attr("role","tablist")};return z.each(function(){var D=this,B=e(D),A=B.is("[data-tab-threshold]")?B.data("tab-threshold"):x.threshold,C=new s(x,y);if(A>0){g.watchResize(function(){if(j>=A&&!B.is("."+u)){C.create.call(D)}else{if(j<A&&B.is("."+u)){C.destroy.call(D)}}})}else{C.create.call(D)}})}}(jQuery,window));